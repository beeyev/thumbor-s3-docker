name:  Build test docker images

on:
  issue_comment:
    types: [created]

concurrency:
  group: ${{ github.event.pull_request.number || github.ref }}-${{github.workflow}}
  cancel-in-progress: true

jobs:
  prepare:
    name: Build test docker images
    if: >
      github.event.issue.pull_request &&
      startsWith(github.event.comment.body, '/build-test')
    runs-on: ubuntu-22.04
    steps:
      - name: Edit comment with error message
        uses: peter-evans/create-or-update-comment@v3
        with:
          reactions: eyes
          comment-id: ${{ github.event.comment.id }}
          body: |
            > [Starting to build test docker images...](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})

  docker-image-deploy:
    name: Deploy docker image
    uses: ./.github/workflows/callable-build-docker-images.yml
    needs: prepare
    with:
      DOCKER_REGISTRY_IMAGE: ghcr.io/${{ github.repository }}:app-test1
      APP_ENV: test
#
#
#  success:
#    needs: spin-up-service
#    runs-on: ubuntu-22.04
#    steps:
#      - name: Add success reaction
#        uses: peter-evans/create-or-update-comment@v3
#        with:
#          comment-id: ${{ github.event.comment.id }}
#          reactions: hooray
#          reactions-edit-mode: replace
#          body: |
#            > Test docker images build succeeded ✅
#
#  failure:
#    if: ${{ failure() }}
#    runs-on: ubuntu-22.04
#    steps:
#      - name: Add failure reaction
#        if: ${{ failure() }}
#        uses: peter-evans/create-or-update-comment@v3
#        with:
#          comment-id: ${{ github.event.comment.id }}
#          reactions: confused
#          reactions-edit-mode: replace
#          body: |
#            > Test docker images build failed ❌
